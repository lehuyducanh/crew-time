<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Time Calculator</title>
  <!-- Import Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <!-- Import Moment.js t·ª´ CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { 
      box-sizing: border-box; 
      transition: all 0.3s ease;
    }
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #e4eefc, #fff);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .top-bar {
      background-color: #0f1e7d;
      padding: 16px;
      text-align: center;
    }
    .top-bar h1 {
      margin: 0;
      color: #fff;
      font-size: 24px;
      font-weight: bold;
    }
    .container {
      max-width: 400px;
      width: 90%;
      margin: 30px auto 50px auto;
      background: #fff;
      padding: 20px 20px 30px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    .label-title {
      margin: 15px 0 5px 0;
      font-weight: bold;
      font-size: 16px;
      color: #0f1e7d;
      display: block;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .btn-option {
      flex: 1;
      border: 1px solid #e0e0e0;
      background-color: #fff;
      color: #e0e0e0;
      padding: 10px 0;
      border-radius: 5px;
      text-align: center;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-option.active {
      border: 1px solid #0f1e7d;
      color: #0f1e7d;
    }
    select, input[type="time"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      border-radius: 5px;
      font-size: 14px;
    }
    .result-title {
      font-weight: bold;
      max-width: 320px;
      margin: 20px 0 10px 0;
      line-height: 1.5;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      font-size: 14px;
    }
    table tr:nth-child(2n) {
      background-color: #f2f2f2;
    }
    th, td {
      text-align: left;
      padding: 8px;
    }
    th {
      background-color: #f9f9f9;
      color: #333;
      font-weight: bold;
    }
    .footer {
      text-align: center;
      font-style: italic;
      color: #666;
    }
    /* Media Query cho thi·∫øt b·ªã di ƒë·ªông */
    @media (max-width: 480px) {
      .top-bar h1 {
        font-size: 20px;
      }
      .btn-group .btn-option {
        font-size: 14px;
        padding: 8px 0;
      }
      select, input[type="time"] {
        font-size: 14px;
        padding: 6px;
      }
      .result-title {
        font-size: 16px;
      }
      table, th, td {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <!-- Thanh ti√™u ƒë·ªÅ -->
  <div class="top-bar">
    <h1>TIME CALCULATOR</h1>
  </div>
  
  <div class="container">
    <!-- Ch·ªçn ngh·ªÅ (Ti·∫øp vi√™n/Phi c√¥ng) -->
    <span class="label-title">ü§µ B·∫°n l√†</span>
    <div class="btn-group" id="jobGroup">
      <div class="btn-option" data-value="1" onclick="selectJob(1)">TI·∫æP VI√äN</div>
      <div class="btn-option" data-value="0" onclick="selectJob(0)">PHI C√îNG</div>
    </div>

    <!-- Ch·ªçn base (HAN/SGN) -->
    <span class="label-title">üìç Ch·ªçn base</span>
    <div class="btn-group" id="baseGroup">
      <div class="btn-option" data-value="HAN" onclick="selectBase('HAN')">HAN</div>
      <div class="btn-option" data-value="SGN" onclick="selectBase('SGN')">SGN</div>
    </div>

    <!-- Ch·ªçn lo·∫°i chuy·∫øn bay (c·∫≠p nh·∫≠t theo base) -->
    <label class="label-title">‚úàÔ∏è Ch·ªçn lo·∫°i chuy·∫øn bay</label>
    <select id="flightType" onchange="calculateTimes()"></select>

    <!-- Ch·ªçn gi·ªù bay -->
    <label for="flightTime" class="label-title">‚è∞ Ch·ªçn gi·ªù bay (Local Time)</label>
    <input type="time" id="flightTime" value="22:00" oninput="calculateTimes()"/>

    <!-- Hi·ªÉn th·ªã k·∫øt qu·∫£ -->
    <p class="result-title" id="description">L·ªãch chu·∫©n b·ªã ...</p>
    <table>
      <thead>
        <tr>
          <th>Lo·∫°i</th>
          <th>Gi·ªù (Local Time)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="row1Label">Gi·ªù xe ƒë√≥n</td>
          <td id="row1Time">--:--</td>
        </tr>
        <tr>
          <td id="row2Label">Gi·ªù h·ªçp BRF</td>
          <td id="row2Time">--:--</td>
        </tr>
      </tbody>
    </table>
    <p class="footer">Nice flight ‚úàÔ∏è via Ha120</p>
  </div>

  <script>
    // Bi·∫øn to√†n c·ª•c
    let job = 1;      // 1 = Ti·∫øp vi√™n, 0 = Phi c√¥ng
    let base = "HAN"; // Gi√° tr·ªã m·∫∑c ƒë·ªãnh
    const flightTypeSelect = document.getElementById("flightType");

    // Danh s√°ch lo·∫°i chuy·∫øn bay cho t·ª´ng base
    const flightTypes = {
      HAN: [
        { label: "N·ªôi ƒë·ªãa, qu·ªëc t·∫ø ng·∫Øn (FT < 4h)", value: "0" },
        { label: "Qu·ªëc t·∫ø t·∫ßm trung v·ªÅ ngay (4h ‚â§ FT ‚â§ 7h, kh√¥ng k√Ω g·ª≠i)", value: "1" },
        { label: "Qu·ªëc t·∫ø t·∫ßm trung, d√†i (FT ‚â• 4h, c√≥ k√Ω g·ª≠i)", value: "2" },
        { label: "Cabin Cargo/ Belly Cargo", value: "3" },
        { label: "Chuy√™n c∆°", value: "4" },
      ],
      SGN: [
        { label: "N·ªôi ƒë·ªãa (B787, A350, A321)", value: "0" },
        { label: "Qu·ªëc t·∫ø ng·∫Øn (B787, A350, A321), FT < 4h", value: "1" },
        { label: "Qu·ªëc t·∫ø t·∫ßm trung v·ªÅ ngay (4h ‚â§ FT ‚â§ 7h, kh√¥ng k√Ω g·ª≠i)", value: "2" },
        { label: "Qu·ªëc t·∫ø t·∫ßm trung (4h ‚â§ FT ‚â§ 7h)", value: "3" },
        { label: "Qu·ªëc t·∫ø d√†i (FT ‚â• 7h, √Çu, √öc)", value: "4" },
        { label: "Qu·ªëc t·∫ø d√†i (FT ‚â• 7h, M·ªπ)", value: "5" },
        { label: "Cabin Cargo/ Belly Cargo", value: "6" },
        { label: "Chuy√™n c∆°", value: "7" },
        { label: "N·ªôi ƒë·ªãa (ATR72)", value: "8" },
        { label: "Qu·ªëc t·∫ø (ATR72)", value: "9" },
        { label: "N·ªôi ƒë·ªãa n·ªëi ti·∫øp qu·ªëc t·∫ø t·∫ßm trung, d√†i c√≥ k√Ω g·ª≠i", value: "10" },
      ],
    };

    // H√†m hi·ªÉn th·ªã danh s√°ch lo·∫°i chuy·∫øn bay theo base
    function populateFlightTypes(currentBase) {
      flightTypeSelect.innerHTML = ""; // X√≥a option c≈©
      const list = flightTypes[currentBase] || [];
      list.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item.value;
        opt.textContent = item.label;
        flightTypeSelect.appendChild(opt);
      });
    }

    // H√†m set tr·∫°ng th√°i n√∫t ƒë√£ ch·ªçn (radio-like)
    function updateActiveButton(groupId, value) {
      const group = document.getElementById(groupId);
      const buttons = group.getElementsByClassName("btn-option");
      for (const btn of buttons) {
        if (btn.dataset.value == value) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      }
    }

    // H√†m ch·ªçn Job
    function selectJob(selectedJob) {
      job = selectedJob;
      updateActiveButton("jobGroup", job);
      calculateTimes();
    }

    // H√†m ch·ªçn Base
    function selectBase(selectedBase) {
      base = selectedBase;
      updateActiveButton("baseGroup", base);
      populateFlightTypes(base);
      calculateTimes();
    }

    // H√†m h·ªó tr·ª£ tr·ª´ gi·ªù b·∫±ng Moment.js
    function subtractTime(timeMoment, hours, minutes) {
      return timeMoment.clone().subtract(hours, "hours").subtract(minutes, "minutes").format("HH:mm");
    }

    // T√≠nh gi·ªù xe ƒë√≥n
    function gioXeDon(type, job, base, flightTime) {
      let pickup = "--:--";
      if (base === "HAN") {
        if (job == "0") { // Phi c√¥ng
          switch (type) {
            case "0":
              pickup = parseInt(flightTime.format("HH")) < 8
                        ? subtractTime(flightTime, 1, 55)
                        : subtractTime(flightTime, 2, 10);
              break;
            case "1":
            case "2":
              pickup = subtractTime(flightTime, 2, 20);
              break;
            case "3":
              pickup = parseInt(flightTime.format("HH")) < 8
                        ? subtractTime(flightTime, 1, 55)
                        : subtractTime(flightTime, 2, 5);
              break;
            case "4":
              pickup = subtractTime(flightTime, 2, 20);
              break;
            default:
              pickup = "--:--";
          }
        } else { // Ti·∫øp vi√™n
          switch (type) {
            case "0":
              pickup = parseInt(flightTime.format("HH")) < 8
                        ? subtractTime(flightTime, 2, 0)
                        : subtractTime(flightTime, 2, 15);
              break;
            case "1":
            case "2":
              pickup = subtractTime(flightTime, 2, 25);
              break;
            case "3":
              pickup = parseInt(flightTime.format("HH")) < 8
                        ? subtractTime(flightTime, 2, 0)
                        : subtractTime(flightTime, 2, 10);
              break;
            case "4":
              pickup = subtractTime(flightTime, 2, 25);
              break;
            default:
              pickup = "--:--";
          }
        }
      } else {
        // SGN
        switch (type) {
          case "0":
            pickup = subtractTime(flightTime, 1, 10);
            break;
          case "1":
          case "2":
            pickup = subtractTime(flightTime, 1, 20);
            break;
          case "3":
            pickup = subtractTime(flightTime, 1, 30);
            break;
          case "4":
            pickup = subtractTime(flightTime, 1, 40);
            break;
          case "5":
            pickup = subtractTime(flightTime, 2, 10);
            break;
          case "6":
            pickup = subtractTime(flightTime, 1, 10);
            break;
          case "7":
            pickup = subtractTime(flightTime, 1, 45);
            break;
          case "8":
            pickup = subtractTime(flightTime, 1, 0);
            break;
          case "9":
            pickup = subtractTime(flightTime, 1, 0);
            break;
          case "10":
            pickup = subtractTime(flightTime, 1, 20);
            break;
          default:
            pickup = "--:--";
        }
      }
      return pickup;
    }

    // T√≠nh gi·ªù h·ªçp BRF
    function gioHop(type, base, flightTime) {
      let brf = "--:--";
      if (base === "HAN") {
        switch (type) {
          case "0":
            brf = parseInt(flightTime.format("HH")) < 8
                    ? subtractTime(flightTime, 1, 30)
                    : subtractTime(flightTime, 1, 35);
            break;
          case "1":
          case "2":
            brf = subtractTime(flightTime, 1, 45);
            break;
          case "3":
            brf = subtractTime(flightTime, 1, 30);
            break;
          case "4":
            brf = subtractTime(flightTime, 1, 55);
            break;
          default:
            brf = "--:--";
        }
      } else {
        // SGN
        switch (type) {
          case "0":
            brf = subtractTime(flightTime, 1, 30);
            break;
          case "1":
            brf = subtractTime(flightTime, 1, 40);
            break;
          case "2":
            brf = subtractTime(flightTime, 1, 45);
            break;
          case "3":
            brf = subtractTime(flightTime, 1, 55);
            break;
          case "4":
            brf = subtractTime(flightTime, 2, 5);
            break;
          case "5":
            brf = subtractTime(flightTime, 2, 35);
            break;
          case "6":
            brf = subtractTime(flightTime, 1, 25);
            break;
          case "7":
            brf = subtractTime(flightTime, 2, 5);
            break;
          case "8":
            brf = subtractTime(flightTime, 1, 15);
            break;
          case "9":
            brf = subtractTime(flightTime, 1, 25);
            break;
          case "10":
            brf = subtractTime(flightTime, 1, 40);
            break;
          default:
            brf = "--:--";
        }
      }
      return brf;
    }

    // T√≠nh to√°n th·ªùi gian v√† c·∫≠p nh·∫≠t giao di·ªán (t·ª± ƒë·ªông theo t·ª´ng input change)
    function calculateTimes() {
      const timeInput = document.getElementById("flightTime").value;
      if (!timeInput || !flightTypeSelect.value) {
        document.getElementById("row1Time").innerText = "--:--";
        document.getElementById("row2Time").innerText = "--:--";
        return;
      }
      const flightTypeValue = flightTypeSelect.value;
      const flightTime = moment(timeInput, "HH:mm");
      const pickup = gioXeDon(flightTypeValue, job, base, flightTime);
      const brf = gioHop(flightTypeValue, base, flightTime);
      
      if (base === "HAN") {
        document.getElementById("row1Label").innerText = "Gi·ªù xe ƒë√≥n";
        document.getElementById("row1Time").innerText = pickup;
        document.getElementById("row2Label").innerText = "Gi·ªù h·ªçp BRF";
        document.getElementById("row2Time").innerText = brf;
      } else {
        document.getElementById("row1Label").innerText = "Gi·ªù h·ªçp BRF";
        document.getElementById("row1Time").innerText = brf;
        document.getElementById("row2Label").innerText = "Gi·ªù xe ƒë√≥n";
        document.getElementById("row2Time").innerText = pickup;
      }
      
      const jobText = (job == "0") ? "phi c√¥ng" : "ti·∫øp vi√™n";
      const flightTypeText = document.querySelector(`#flightType option[value="${flightTypeValue}"]`).textContent;
      document.getElementById("description").innerText = 
        `L·ªãch chu·∫©n b·ªã cho ${jobText} bay ${flightTypeText} t·∫°i Base ${base}`;
    }

    // Khi trang load
    window.onload = function() {
      updateActiveButton("jobGroup", job);
      updateActiveButton("baseGroup", base);
      populateFlightTypes(base);
      calculateTimes();
    }
  </script>
</body>
</html>
